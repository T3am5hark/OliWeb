<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
      <!-- Bootstrap -->
    <link href="../css/bootstrap.min.css" rel="stylesheet">
    
    <style type="text/css">
        html { height: 100% }
        body { height: 100%; margin: 0; padding: 0 }
        #map-canvas { height: 100% }
    </style>
    <style type="text/css">
        textarea {
            font-size: 10pt;
            font-family: Monaco;
        }
    </style>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
    <script type="text/javascript"
            src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCGDSxNEjbRx2J-JOHbAym4ciWEv_njtLs">
    </script>
    <script type="text/javascript">
        var map=null;
        function initialize() {
            var mapOptions = {
                center: new google.maps.LatLng(33.5, -112),
                zoom: 10
            };
            window.map = new google.maps.Map(document.getElementById("map-canvas"),
                    mapOptions);
            map=window.map;
            //loadDatFiles();
        }
        google.maps.event.addDomListener(window, 'load', initialize);
        
    </script>
</head>
<body>
    <div id="map-canvas" style="width:90%;height:50%">
    </div>
    
    <div>
    <h3>
    <select id="datFiles" name="Path Files" multiple>
        
    </select>
    <br>
    <a onclick="loadDatFiles();return false;" href="javascript:void(0);">Load Paths |</a>
    <a onclick="display(); return false;" href="javascript:void(0);">Display</a>
    
    </h3>
    </div>
    
    <div>
        <H3>
        <textarea id="latLongText" readonly="true" cols="38" rows="3" >Press link for map bounds
        </textarea>
        <br>
        <a onclick="getBounds();return false;" href="javascript:void(0);">Get Bounds</a>
        <hr />
        </H3>
    </div>
</body>
<script type="text/javascript">
    function getBounds() {
        var bounds=window.map.getBounds();
        var southWest=bounds.getSouthWest();
        var northEast=bounds.getNorthEast();
        var text="SW="+southWest.toString()+"\n";
        text+="NE="+northEast.toString();
        $("#latLongText").val(text);
    }

    function loadDatFiles(){
        var url = "../lsToHtml.cgi?dir=tracker&ext=dat&noHtml=1";
        console.log(url);
        $.get(url, function(data, status) {
            console.log("status="+status.toString());
            var files=data.split("\n");
            var str="";
            files.forEach( function(file,index) {
                if (file.length > 4){
                          fileClean=file.trim().replace(" ","\ ");
                    console.log(file);
                          //str+="<option value=&quot;"+ file.trim() +
                          //"&quot; >" + file.trim() + "</option>";
                          str+="<option value="+ fileClean +
                          " >" + fileClean + "</option>";
                }
            });
          $("#datFiles").html(str);
        });
    }

    function display(){
        var slct=$("#datFiles");
        var val=slct.val();
        console.log(val);
        val.forEach( function(path,index) {
            loadPath(path);
        });
    }

    function loadPath(pathFile){
        var url = "../tracker/" + pathFile;
        console.log(url);
        coords=[];
        $.get(url, function(data, status){
            console.log("status="+status.toString());
            //console.log(data);
            var lines=data.split("\n");
            lines.forEach( function(line, index) {
                var columns=line.split(",");
                if (columns.length==3){
                    var latLng = {lat: Number(columns[1]), lng: Number(columns[2]) };
                    coords.push( latLng );
                    //console.log(JSON.stringify(latLng));
                }
            });
            color=getColor();
            var path = new google.maps.Polyline({
                                    path: coords,
                                    geodesic: true,
                                    strokeColor: color,
                                    strokeOpacity: 1.0,
                                    strokeWeight: 2
                                                });
            path.setMap(map);
        });
    }

    function getColor(){
        if (++idx == colorPalette.length) idx=0;
        return colorPalette[idx];
    }


    var colorPalette = [
    '#339966',
    '#333399',
    '#336699',
    '#993333',
    '#999933',
    '#663399',
    '#993399',
    '#996633'
                        ];
    var idx=0;
</script>
</html>